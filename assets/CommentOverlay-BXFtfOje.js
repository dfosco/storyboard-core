import{i as E,l as z,g as D,f as S,s as T,o as M,t as A,a as H}from"./index-R9vDGrMr.js";import"./vendor-primer-DemBoo1e.js";import"./vendor-react-BuwH6fqj.js";import"./vendor-octicons-BpazhUNY.js";import"./vendor-reshaped-DaHIQrVt.js";function P(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}let a=null;async function R(){if(!E())return;if(a){u();return}const e=document.createElement("div");e.className="sb-comments-drawer-backdrop fixed top-0 right-0 bottom-0 left-0",e.style.cssText="z-index:99997;background:rgba(0,0,0,0.4)",e.addEventListener("click",u);const i=document.createElement("div");i.className="sb-comments-drawer sb-drawer-animate fixed top-0 right-0 bottom-0 flex flex-column sb-bg bl sb-b-default sb-shadow sans-serif",i.style.cssText="z-index:99998;width:420px;max-width:90vw";const f=document.createElement("div");f.className="flex items-center justify-between ph4 pv3 bb sb-b-muted flex-shrink-0";const w=document.createElement("h2");w.className="f5 fw6 sb-fg ma0",w.textContent="All Comments",f.appendChild(w);const c=document.createElement("button");c.className="flex items-center justify-center bg-transparent bn br2 sb-fg-muted pointer",c.style.cssText="width:28px;height:28px;font-size:18px;line-height:1",c.innerHTML="Ã—",c.setAttribute("aria-label","Close"),c.addEventListener("click",u),f.appendChild(c),i.appendChild(f);const s=document.createElement("div");s.className="flex-auto overflow-y-auto pa0";const h=document.createElement("div");h.className="pv4 ph4 tc sb-fg-muted",h.style.fontSize="13px",h.textContent="Loading commentsâ€¦",s.appendChild(h),i.appendChild(s),document.body.appendChild(e),document.body.appendChild(i),a={backdrop:e,drawer:i};function x(o){o.key==="Escape"&&(o.preventDefault(),o.stopPropagation(),u(),window.removeEventListener("keydown",x,!0))}window.addEventListener("keydown",x,!0),a.onKeyDown=x;try{const o=await z();if(s.innerHTML="",!o||o.length===0){const t=document.createElement("div");t.className="pv4 ph4 tc sb-fg-muted",t.style.fontSize="13px",t.textContent="No comments yet",s.appendChild(t);return}const l=D()?.basePath??"/";for(const t of o){const C=t.title?.match(/^Comments:\s*(.+)$/);if(!C)continue;const m=C[1];if(!m.startsWith(l))continue;let d;try{d=await S(m)}catch{continue}if(!d?.comments?.length)continue;const b=document.createElement("div");b.className="bb sb-b-muted";const v=document.createElement("div");v.className="flex items-center ph4 pv2 sb-bg-inset f7 fw6 sb-fg-muted",v.innerHTML=`<span class="code sb-fg-accent">${m}</span><span class="ml-auto fw4 flex flex-nowrap" style="font-size:11px;min-width:max-content">${d.comments.length} comment${d.comments.length!==1?"s":""}</span>`,b.appendChild(v);for(const n of d.comments){const g=!!n.meta?.resolved,p=document.createElement("button");p.className="flex ph4 pv2 pointer bn bg-transparent w-100 tl sans-serif",p.style.cssText=`font:inherit;transition:background 100ms${g?";opacity:0.6":""}`;const k=n.author?.avatarUrl?`<img class="br-100 ba sb-b-default flex-shrink-0 mr2" style="width:24px;height:24px" src="${n.author.avatarUrl}" alt="${n.author?.login??""}" />`:"",$=g?'<span class="sb-fg-success br-pill ph1" style="font-size:10px;background:color-mix(in srgb, var(--sb-fg-success) 10%, transparent)">Resolved</span>':"",L=g?"sb-fg-muted":"sb-fg",y=n.replies?.length??0,N=y>0?`<div class="sb-fg-muted mt1" style="font-size:11px">ðŸ’¬ ${y} ${y===1?"reply":"replies"}</div>`:"";p.innerHTML=`
          ${k}
          <div class="flex-auto" style="min-width:0">
            <div class="flex items-center mb1">
              <span class="f7 fw6 ${g?"sb-fg-muted":"sb-fg"} mr1">${n.author?.login??"unknown"}</span>
              ${n.createdAt?`<span class="sb-fg-muted mr1" style="font-size:11px">${P(n.createdAt)}</span>`:""}
              ${$}
            </div>
            <p class="${L} ma0 overflow-hidden nowrap truncate lh-copy" style="font-size:13px;text-overflow:ellipsis">${n.text?.slice(0,100)??""}</p>
            ${N}
          </div>
        `,p.addEventListener("click",()=>{if(u(),window.location.pathname!==m){const r=new URL(window.location.href);r.pathname=m,r.searchParams.set("comment",n.id),window.location.href=r.toString()}else{const r=new URL(window.location.href);r.searchParams.set("comment",n.id),window.history.replaceState(null,"",r.toString()),T(!0)}}),b.appendChild(p)}s.appendChild(b)}if(s.children.length===0){const t=document.createElement("div");t.className="pv4 ph4 tc sb-fg-muted",t.style.fontSize="13px",t.textContent="No comments yet",s.appendChild(t)}}catch(o){s.innerHTML="";const l=document.createElement("div");l.className="pv4 ph4 tc sb-fg-muted",l.style.fontSize="13px",l.textContent=`Failed to load comments: ${o.message}`,s.appendChild(l)}}function u(){a&&(a.onKeyDown&&window.removeEventListener("keydown",a.onKeyDown,!0),a.backdrop.remove(),a.drawer.remove(),a=null)}function I(){const e=[];return E()?(e.push({label:"Toggle comments",icon:"ðŸ’¬",onClick:()=>{A()}}),e.push({label:"See all comments",icon:"ðŸ“‹",onClick:()=>{R()}}),e.push({label:"Sign out of comments",icon:"ðŸšª",onClick:()=>{H()}})):e.push({label:"Sign in for comments",icon:"ðŸ’¬",onClick:()=>{M()}}),e}export{I as getCommentsMenuItems};
